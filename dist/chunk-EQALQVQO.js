import {
  ToolNotFoundError,
  ZENSICAL_INSTALL_CMD,
  runTool
} from "./chunk-RI67YQXQ.js";

// src/deploy/providers/github-pages.ts
import { writeFile } from "fs/promises";
import path from "path";
var GitHubPagesProvider = class {
  id = "gh-pages";
  name = "GitHub Pages";
  async checkAuth() {
    const token = process.env.GITHUB_TOKEN || process.env.GH_TOKEN;
    if (token) {
      return { authenticated: true, message: "GitHub token found" };
    }
    try {
      await runTool("gh", ["auth", "status"]);
      return { authenticated: true, message: "Authenticated via gh CLI" };
    } catch {
      return {
        authenticated: false,
        message: "No GitHub authentication found. Set GITHUB_TOKEN or run `gh auth login`."
      };
    }
  }
  async setupProject(deploy, domain) {
    return { projectId: deploy.project || "docs" };
  }
  async deploy(buildDir, deploy, domain) {
    if (domain.custom) {
      const cnamePath = path.join(buildDir, "CNAME");
      await writeFile(cnamePath, domain.custom);
    }
    return {
      url: domain.custom ? `https://${domain.custom}${domain.base_path}` : `https://<username>.github.io/<repo>${domain.base_path}`,
      provider: this.id,
      projectId: deploy.project || "docs",
      domain: domain.custom,
      ssl: true
    };
  }
  async undeploy(deploy, domain) {
    try {
      await runTool("gh", [
        "api",
        "--method",
        "DELETE",
        "repos/{owner}/{repo}/pages"
      ]);
      return {
        success: true,
        message: "GitHub Pages has been disabled for this repository"
      };
    } catch {
      return {
        success: false,
        message: "Could not disable GitHub Pages automatically. Go to Settings \u2192 Pages in your repository to disable it manually."
      };
    }
  }
  async configureDomain(domain, deploy) {
    if (!domain.custom) {
      return { configured: true };
    }
    const isSubdomain = domain.custom.split(".").length > 2;
    const dnsRecords = isSubdomain ? [
      {
        type: "CNAME",
        name: domain.custom.split(".")[0],
        value: "<username>.github.io"
      }
    ] : [
      { type: "A", name: "@", value: "185.199.108.153" },
      { type: "A", name: "@", value: "185.199.109.153" },
      { type: "A", name: "@", value: "185.199.110.153" },
      { type: "A", name: "@", value: "185.199.111.153" }
    ];
    return { configured: false, dnsRecords };
  }
  async generateCIConfig(deploy, domain) {
    const content = `# DocWalk \u2014 GitHub Pages Deployment
# Auto-generated by DocWalk. Modify with care.

name: Deploy Documentation

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: DocWalk Sync and Generate
        run: |
          docwalk sync
          docwalk generate

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: site

  deploy:
    environment:
      name: github-pages
      url: \${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
`;
    return {
      path: ".github/workflows/docwalk-deploy.yml",
      content
    };
  }
  async generatePreviewCIConfig(deploy, domain) {
    const content = `# DocWalk \u2014 PR Preview Deployment
# Auto-generated by DocWalk. Builds docs on PR and posts a preview artifact link.

name: PR Documentation Preview

on:
  pull_request:
    branches: [main]

permissions:
  contents: read
  pull-requests: write

jobs:
  preview:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: DocWalk Generate
        run: docwalk generate --full

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Upload preview artifact
        uses: actions/upload-artifact@v4
        with:
          name: docs-preview-pr-\${{ github.event.pull_request.number }}
          path: site
          retention-days: 5

      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const runUrl = \`\${context.serverUrl}/\${context.repo.owner}/\${context.repo.repo}/actions/runs/\${context.runId}\`;
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: \`## Documentation Preview\\n\\nDocs preview built successfully.\\n\\nDownload the preview artifact from the [workflow run](\${runUrl}).\\n\\n> _Generated by DocWalk_\`
            });
`;
    return {
      path: ".github/workflows/docwalk-preview.yml",
      content
    };
  }
};

// src/deploy/providers/cloudflare.ts
var CloudflareProvider = class {
  id = "cloudflare";
  name = "Cloudflare Pages";
  async checkAuth() {
    const token = process.env.CLOUDFLARE_API_TOKEN;
    const accountId = process.env.CLOUDFLARE_ACCOUNT_ID;
    if (token && accountId) {
      return { authenticated: true, message: "Cloudflare credentials found" };
    }
    try {
      await runTool("npx", ["wrangler", "whoami"]);
      return {
        authenticated: true,
        message: "Authenticated via Wrangler CLI"
      };
    } catch (error) {
      if (error instanceof ToolNotFoundError) {
        return { authenticated: false, message: error.message };
      }
      return {
        authenticated: false,
        message: "Set CLOUDFLARE_API_TOKEN and CLOUDFLARE_ACCOUNT_ID, or run `npx wrangler login`."
      };
    }
  }
  async setupProject(deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    try {
      await runTool("npx", [
        "wrangler",
        "pages",
        "project",
        "create",
        projectName,
        "--production-branch",
        "main"
      ]);
    } catch {
    }
    return { projectId: projectName };
  }
  async deploy(buildDir, deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    const result = await runTool("npx", [
      "wrangler",
      "pages",
      "deploy",
      buildDir,
      "--project-name",
      projectName
    ]);
    const stdout = String(result.stdout ?? "");
    const urlMatch = stdout.match(/https:\/\/[^\s]+\.pages\.dev/);
    const url = urlMatch?.[0] || `https://${projectName}.pages.dev`;
    return {
      url: domain.custom ? `https://${domain.custom}${domain.base_path}` : url,
      previewUrl: url,
      provider: this.id,
      projectId: projectName,
      domain: domain.custom,
      ssl: true
    };
  }
  async undeploy(deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    try {
      await runTool("npx", [
        "wrangler",
        "pages",
        "project",
        "delete",
        projectName,
        "--yes"
      ]);
      return {
        success: true,
        message: `Cloudflare Pages project '${projectName}' has been deleted`
      };
    } catch (error) {
      if (error instanceof ToolNotFoundError) {
        return { success: false, message: error.message };
      }
      return {
        success: false,
        message: `Could not delete Cloudflare Pages project '${projectName}'. Delete it manually from the Cloudflare dashboard.`
      };
    }
  }
  async configureDomain(domain, deploy) {
    if (!domain.custom) {
      return { configured: true };
    }
    const projectName = deploy.project || "docwalk-docs";
    try {
      await runTool("npx", [
        "wrangler",
        "pages",
        "project",
        "add-custom-domain",
        projectName,
        domain.custom
      ]);
      return { configured: true };
    } catch {
      return {
        configured: false,
        dnsRecords: [
          {
            type: "CNAME",
            name: domain.custom.split(".")[0],
            value: `${projectName}.pages.dev`
          }
        ]
      };
    }
  }
  async generateCIConfig(deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    const content = `# DocWalk \u2014 Cloudflare Pages Deployment
# Auto-generated by DocWalk. Modify with care.

name: Deploy Documentation

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      deployments: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: DocWalk Sync and Generate
        run: |
          docwalk sync
          docwalk generate

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Deploy to Cloudflare Pages
        uses: cloudflare/wrangler-action@v3
        with:
          apiToken: \${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: \${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          command: pages deploy site --project-name ${projectName}
`;
    return {
      path: ".github/workflows/docwalk-deploy.yml",
      content
    };
  }
  async generatePreviewCIConfig(deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    const content = `# DocWalk \u2014 PR Preview Deployment (Cloudflare Pages)
# Auto-generated by DocWalk. Deploys a preview branch on each PR.

name: PR Documentation Preview

on:
  pull_request:
    branches: [main]

jobs:
  preview:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      deployments: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: DocWalk Generate
        run: docwalk generate --full

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Deploy Preview to Cloudflare Pages
        id: deploy
        uses: cloudflare/wrangler-action@v3
        with:
          apiToken: \${{ secrets.CLOUDFLARE_API_TOKEN }}
          accountId: \${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
          command: pages deploy site --project-name ${projectName} --branch pr-\${{ github.event.pull_request.number }}

      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const previewUrl = \`https://pr-\${{ github.event.pull_request.number }}.${projectName}.pages.dev\`;
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: \`## Documentation Preview\\n\\nPreview deployed to: \${previewUrl}\\n\\n> _Generated by DocWalk_\`
            });
`;
    return {
      path: ".github/workflows/docwalk-preview.yml",
      content
    };
  }
};

// src/deploy/providers/vercel.ts
import { writeFile as writeFile2 } from "fs/promises";
import path2 from "path";
var VercelProvider = class {
  id = "vercel";
  name = "Vercel";
  async checkAuth() {
    const token = process.env.VERCEL_TOKEN;
    if (token) {
      return { authenticated: true, message: "Vercel token found" };
    }
    try {
      await runTool("npx", ["vercel", "whoami"]);
      return { authenticated: true, message: "Authenticated via Vercel CLI" };
    } catch (error) {
      if (error instanceof ToolNotFoundError) {
        return { authenticated: false, message: error.message };
      }
      return {
        authenticated: false,
        message: "Set VERCEL_TOKEN or run `npx vercel login`."
      };
    }
  }
  async setupProject(deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    return { projectId: projectName };
  }
  async deploy(buildDir, deploy, domain) {
    const vercelConfig = {
      version: 2,
      name: deploy.project || "docwalk-docs",
      builds: [{ src: "**", use: "@vercel/static" }],
      routes: [
        { handle: "filesystem" },
        { src: "/(.*)", dest: "/index.html" }
      ]
    };
    await writeFile2(
      path2.join(buildDir, "vercel.json"),
      JSON.stringify(vercelConfig, null, 2)
    );
    const args = ["vercel", "--prod", "--yes", buildDir];
    if (process.env.VERCEL_TOKEN) {
      args.push("--token", process.env.VERCEL_TOKEN);
    }
    const result = await runTool("npx", args);
    const stdout = String(result.stdout ?? "");
    const url = stdout.trim().split("\n").pop() || "";
    return {
      url: domain.custom ? `https://${domain.custom}${domain.base_path}` : url,
      previewUrl: url,
      provider: this.id,
      projectId: deploy.project || "docwalk-docs",
      domain: domain.custom,
      ssl: true
    };
  }
  async undeploy(deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    try {
      await runTool("npx", ["vercel", "rm", projectName, "--yes"]);
      return {
        success: true,
        message: `Vercel project '${projectName}' has been removed`
      };
    } catch (error) {
      if (error instanceof ToolNotFoundError) {
        return { success: false, message: error.message };
      }
      return {
        success: false,
        message: `Could not remove Vercel project '${projectName}'. Delete it manually from the Vercel dashboard.`
      };
    }
  }
  async configureDomain(domain, deploy) {
    if (!domain.custom) return { configured: true };
    try {
      await runTool("npx", ["vercel", "domains", "add", domain.custom]);
      return { configured: true };
    } catch {
      return {
        configured: false,
        dnsRecords: [
          {
            type: "CNAME",
            name: domain.custom.split(".")[0],
            value: "cname.vercel-dns.com"
          }
        ]
      };
    }
  }
  async generateCIConfig(deploy, domain) {
    const content = `# DocWalk \u2014 Vercel Deployment
# Auto-generated by DocWalk. Modify with care.

name: Deploy Documentation

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: DocWalk Sync and Generate
        run: |
          docwalk sync
          docwalk generate

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: \${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: \${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: \${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: site
          vercel-args: --prod
`;
    return {
      path: ".github/workflows/docwalk-deploy.yml",
      content
    };
  }
  async generatePreviewCIConfig(deploy, domain) {
    const content = `# DocWalk \u2014 PR Preview Deployment (Vercel)
# Auto-generated by DocWalk. Deploys a preview on each PR.

name: PR Documentation Preview

on:
  pull_request:
    branches: [main]

jobs:
  preview:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: DocWalk Generate
        run: docwalk generate --full

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Deploy Preview to Vercel
        id: deploy
        uses: amondnet/vercel-action@v25
        with:
          vercel-token: \${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: \${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: \${{ secrets.VERCEL_PROJECT_ID }}
          working-directory: site

      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const previewUrl = '\${{ steps.deploy.outputs.preview-url }}';
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: \`## Documentation Preview\\n\\nPreview deployed to: \${previewUrl}\\n\\n> _Generated by DocWalk_\`
            });
`;
    return {
      path: ".github/workflows/docwalk-preview.yml",
      content
    };
  }
};

// src/deploy/providers/netlify.ts
var NetlifyProvider = class {
  id = "netlify";
  name = "Netlify";
  async checkAuth() {
    const token = process.env.NETLIFY_AUTH_TOKEN;
    if (token) {
      return { authenticated: true, message: "Netlify auth token found" };
    }
    try {
      await runTool("netlify", ["status"]);
      return {
        authenticated: true,
        message: "Authenticated via Netlify CLI"
      };
    } catch (error) {
      if (error instanceof ToolNotFoundError) {
        return { authenticated: false, message: error.message };
      }
      return {
        authenticated: false,
        message: "Set NETLIFY_AUTH_TOKEN or run `netlify login`."
      };
    }
  }
  async setupProject(deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    try {
      await runTool("netlify", ["sites:create", "--name", projectName]);
    } catch {
    }
    return { projectId: projectName };
  }
  async deploy(buildDir, deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    const result = await runTool("netlify", [
      "deploy",
      "--dir",
      buildDir,
      "--prod",
      "--site",
      projectName
    ]);
    const stdout = String(result.stdout ?? "");
    const urlMatch = stdout.match(/https:\/\/[^\s]+\.netlify\.app/);
    const url = urlMatch?.[0] || `https://${projectName}.netlify.app`;
    return {
      url: domain.custom ? `https://${domain.custom}${domain.base_path}` : url,
      previewUrl: url,
      provider: this.id,
      projectId: projectName,
      domain: domain.custom,
      ssl: true
    };
  }
  async undeploy(deploy, domain) {
    const projectName = deploy.project || "docwalk-docs";
    try {
      await runTool("netlify", [
        "sites:delete",
        "--site",
        projectName,
        "--force"
      ]);
      return {
        success: true,
        message: `Netlify site '${projectName}' has been deleted`
      };
    } catch (error) {
      if (error instanceof ToolNotFoundError) {
        return { success: false, message: error.message };
      }
      return {
        success: false,
        message: `Could not delete Netlify site '${projectName}'. Delete it manually from the Netlify dashboard.`
      };
    }
  }
  async configureDomain(domain, deploy) {
    if (!domain.custom) {
      return { configured: true };
    }
    const projectName = deploy.project || "docwalk-docs";
    return {
      configured: false,
      dnsRecords: [
        {
          type: "CNAME",
          name: domain.custom.split(".")[0],
          value: `${projectName}.netlify.app`
        }
      ]
    };
  }
  async generateCIConfig(deploy, domain) {
    const content = `# DocWalk \u2014 Netlify Deployment
# Auto-generated by DocWalk. Modify with care.

name: Deploy Documentation

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      deployments: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: DocWalk Sync and Generate
        run: |
          docwalk sync
          docwalk generate

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Deploy to Netlify
        uses: nwtgck/actions-netlify@v3
        with:
          publish-dir: ./site
          production-deploy: true
          github-token: \${{ secrets.GITHUB_TOKEN }}
        env:
          NETLIFY_AUTH_TOKEN: \${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: \${{ secrets.NETLIFY_SITE_ID }}
`;
    return {
      path: ".github/workflows/docwalk-deploy.yml",
      content
    };
  }
  async generatePreviewCIConfig(deploy, domain) {
    const content = `# DocWalk \u2014 PR Preview Deployment (Netlify)
# Auto-generated by DocWalk. Deploys a preview on each PR.

name: PR Documentation Preview

on:
  pull_request:
    branches: [main]

jobs:
  preview:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: DocWalk Generate
        run: docwalk generate --full

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Deploy Preview to Netlify
        id: deploy
        uses: nwtgck/actions-netlify@v3
        with:
          publish-dir: ./site
          production-deploy: false
          github-token: \${{ secrets.GITHUB_TOKEN }}
          deploy-message: "PR #\${{ github.event.pull_request.number }} preview"
        env:
          NETLIFY_AUTH_TOKEN: \${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: \${{ secrets.NETLIFY_SITE_ID }}

      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const deployUrl = '\${{ steps.deploy.outputs.deploy-url }}';
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: \`## Documentation Preview\\n\\nPreview deployed to: \${deployUrl}\\n\\n> _Generated by DocWalk_\`
            });
`;
    return {
      path: ".github/workflows/docwalk-preview.yml",
      content
    };
  }
};

// src/deploy/providers/s3.ts
var S3Provider = class {
  id = "s3";
  name = "AWS S3";
  async checkAuth() {
    const accessKey = process.env.AWS_ACCESS_KEY_ID;
    const secretKey = process.env.AWS_SECRET_ACCESS_KEY;
    if (accessKey && secretKey) {
      return { authenticated: true, message: "AWS credentials found" };
    }
    try {
      await runTool("aws", ["sts", "get-caller-identity"]);
      return {
        authenticated: true,
        message: "Authenticated via AWS CLI"
      };
    } catch (error) {
      if (error instanceof ToolNotFoundError) {
        return { authenticated: false, message: error.message };
      }
      return {
        authenticated: false,
        message: "Set AWS_ACCESS_KEY_ID and AWS_SECRET_ACCESS_KEY, or configure AWS CLI with `aws configure`."
      };
    }
  }
  async setupProject(deploy, domain) {
    const bucketName = deploy.project || "docwalk-docs";
    const region = deploy.provider_config?.region || "us-east-1";
    try {
      await runTool("aws", [
        "s3",
        "mb",
        `s3://${bucketName}`,
        "--region",
        region
      ]);
      await runTool("aws", [
        "s3",
        "website",
        `s3://${bucketName}`,
        "--index-document",
        "index.html",
        "--error-document",
        "404.html"
      ]);
    } catch {
    }
    return { projectId: bucketName };
  }
  async deploy(buildDir, deploy, domain) {
    const bucketName = deploy.project || "docwalk-docs";
    const region = deploy.provider_config?.region || "us-east-1";
    const cloudFrontId = deploy.provider_config?.cloudfront_distribution_id;
    await runTool("aws", [
      "s3",
      "sync",
      buildDir,
      `s3://${bucketName}`,
      "--delete",
      "--region",
      region
    ]);
    if (cloudFrontId) {
      try {
        await runTool("aws", [
          "cloudfront",
          "create-invalidation",
          "--distribution-id",
          cloudFrontId,
          "--paths",
          "/*"
        ]);
      } catch {
      }
    }
    const baseUrl = domain.custom ? `https://${domain.custom}${domain.base_path}` : `http://${bucketName}.s3-website-${region}.amazonaws.com`;
    return {
      url: baseUrl,
      provider: this.id,
      projectId: bucketName,
      domain: domain.custom,
      ssl: !!domain.custom || !!cloudFrontId
    };
  }
  async undeploy(deploy, domain) {
    const bucketName = deploy.project || "docwalk-docs";
    try {
      await runTool("aws", [
        "s3",
        "rm",
        `s3://${bucketName}`,
        "--recursive"
      ]);
      await runTool("aws", [
        "s3",
        "rb",
        `s3://${bucketName}`
      ]);
      return {
        success: true,
        message: `S3 bucket '${bucketName}' has been deleted`
      };
    } catch (error) {
      if (error instanceof ToolNotFoundError) {
        return { success: false, message: error.message };
      }
      return {
        success: false,
        message: `Could not delete S3 bucket '${bucketName}'. Delete it manually from the AWS console.`
      };
    }
  }
  async configureDomain(domain, deploy) {
    if (!domain.custom) {
      return { configured: true };
    }
    const bucketName = deploy.project || "docwalk-docs";
    const region = deploy.provider_config?.region || "us-east-1";
    return {
      configured: false,
      dnsRecords: [
        {
          type: "CNAME",
          name: domain.custom.split(".")[0],
          value: `${bucketName}.s3-website-${region}.amazonaws.com`
        }
      ]
    };
  }
  async generateCIConfig(deploy, domain) {
    const bucketName = deploy.project || "docwalk-docs";
    const region = deploy.provider_config?.region || "us-east-1";
    const cloudFrontId = deploy.provider_config?.cloudfront_distribution_id;
    const invalidationStep = cloudFrontId ? `
      - name: Invalidate CloudFront Cache
        run: aws cloudfront create-invalidation --distribution-id ${cloudFrontId} --paths "/*"
` : "";
    const content = `# DocWalk \u2014 AWS S3 Deployment
# Auto-generated by DocWalk. Modify with care.

name: Deploy Documentation

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      id-token: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: \${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: \${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${region}

      - name: DocWalk Sync and Generate
        run: |
          docwalk sync
          docwalk generate

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Deploy to S3
        run: aws s3 sync site s3://${bucketName} --delete
${invalidationStep}`;
    return {
      path: ".github/workflows/docwalk-deploy.yml",
      content
    };
  }
  async generatePreviewCIConfig(deploy, domain) {
    const bucketName = deploy.project || "docwalk-docs";
    const region = deploy.provider_config?.region || "us-east-1";
    const content = `# DocWalk \u2014 PR Preview Deployment (AWS S3)
# Auto-generated by DocWalk. Deploys a preview to a PR-specific prefix.

name: PR Documentation Preview

on:
  pull_request:
    branches: [main]

jobs:
  preview:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: npm

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install DocWalk
        run: npm install -g docwalk

      - name: Install Zensical
        run: ${ZENSICAL_INSTALL_CMD}

      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: \${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: \${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ${region}

      - name: DocWalk Generate
        run: docwalk generate --full

      - name: Build Site
        run: zensical build --config-file docwalk-output/mkdocs.yml --site-dir site

      - name: Deploy Preview to S3
        run: aws s3 sync site s3://${bucketName}/pr-\${{ github.event.pull_request.number }} --delete

      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const previewUrl = 'http://${bucketName}.s3-website-${region}.amazonaws.com/pr-\${{ github.event.pull_request.number }}';
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: \`## Documentation Preview\\n\\nPreview deployed to: \${previewUrl}\\n\\n> _Generated by DocWalk_\`
            });
`;
    return {
      path: ".github/workflows/docwalk-preview.yml",
      content
    };
  }
};

// src/deploy/index.ts
var providers = /* @__PURE__ */ new Map();
function registerProvider(provider) {
  providers.set(provider.id, provider);
}
function getProvider(id) {
  return providers.get(id);
}
function getAvailableProviders() {
  return [...providers.values()];
}
registerProvider(new GitHubPagesProvider());
registerProvider(new CloudflareProvider());
registerProvider(new VercelProvider());
registerProvider(new NetlifyProvider());
registerProvider(new S3Provider());

export {
  registerProvider,
  getProvider,
  getAvailableProviders
};
